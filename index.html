const questions = {
  history: [
    {
      topic: "हड़प्पा",
      q: "हड़प्पा किस सभ्यता से सम्बंधित है?",
      options: ["मिस्र", "सिंधु घाटी", "मेसोपोटामिया", "चीन"],
      answer: "सिंधु घाटी"
    },
    {
      topic: "अशोक",
      q: "अशोक किस वंश से था?",
      options: ["गुप्त", "मौर्य", "कुषाण", "मुगल"],
      answer: "मौर्य"
    }
  ],
  science: [
    {
      topic: "पानी",
      q: "पानी का रासायनिक सूत्र क्या है?",
      options: ["CO2", "H2O", "O2", "NaCl"],
      answer: "H2O"
    }
  ]
};

let currentCategory = "";
let currentQuestions = [];
let currentIndex = 0;
let userAnswers = [];

function showCategories() {
  document.getElementById("welcomePage").classList.add("hidden");
  document.getElementById("categoryPage").classList.remove("hidden");
}

function showTopics(category) {
  currentCategory = category;
  document.getElementById("categoryPage").classList.add("hidden");
  document.getElementById("topicsPage").classList.remove("hidden");

  document.getElementById("topicTitle").innerText = category.toUpperCase();
  const topicList = document.getElementById("topicList");
  topicList.innerHTML = "";
  questions[category].forEach((q, i) => {
    let btn = document.createElement("button");
    btn.innerText = (i+1) + ". " + q.topic;
    btn.className = "category-btn";
    btn.style.background = "green";
    btn.onclick = () => startQuiz(i);
    topicList.appendChild(btn);
  });
}

function backToCategories() {
  document.getElementById("topicsPage").classList.add("hidden");
  document.getElementById("categoryPage").classList.remove("hidden");
}

function backToTopics() {
  document.getElementById("quizPage").classList.add("hidden");
  document.getElementById("topicsPage").classList.remove("hidden");
}

function startQuiz(index) {
  currentQuestions = questions[currentCategory];
  currentIndex = index;
  userAnswers = [];
  document.getElementById("topicsPage").classList.add("hidden");
  document.getElementById("quizPage").classList.remove("hidden");
  loadQuestion();
}

function loadQuestion() {
  let q = currentQuestions[currentIndex];
  document.getElementById("question").innerText = q.q;
  let optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";

  q.options.forEach(opt => {
    let btn = document.createElement("button");
    btn.innerText = opt;
    btn.onclick = () => selectAnswer(opt);
    optionsDiv.appendChild(btn);
  });

  document.getElementById("prevBtn").disabled = currentIndex === 0;
  document.getElementById("nextBtn").style.display = currentIndex === currentQuestions.length - 1 ? "none" : "inline-block";
  document.getElementById("finishBtn").style.display = currentIndex === currentQuestions.length - 1 ? "inline-block" : "none";
}

function selectAnswer(answer) {
  userAnswers[currentIndex] = answer;
}

function prevQuestion() {
  if (currentIndex > 0) {
    currentIndex--;
    loadQuestion();
  }
}
function nextQuestion() {
  if (currentIndex < currentQuestions.length - 1) {
    currentIndex++;
    loadQuestion();
  }
}

function finishQuiz() {
  document.getElementById("quizPage").classList.add("hidden");
  document.getElementById("resultPage").classList.remove("hidden");

  let correct = 0;
  let wrong = 0;
  let total = currentQuestions.length;

  let answersDiv = document.getElementById("answers");
  answersDiv.innerHTML = "";

  currentQuestions.forEach((q, i) => {
    let userAns = userAnswers[i] || "❌ चुना नहीं";
    let isCorrect = userAns === q.answer;
    if (isCorrect) correct++; else wrong++;

    let div = document.createElement("div");
    div.innerHTML = (isCorrect ? "✔️ " : "❌ ") + (i+1) + ". " + q.q +
      "<br> आपका उत्तर: <button style='background:"+(isCorrect?"green":"red")+";color:white'>" + userAns + "</button>" +
      (isCorrect ? "" : "<br> सही उत्तर: <button style='background:green;color:white'>" + q.answer + "</button>");
    div.style.marginBottom = "15px";
    answersDiv.appendChild(div);
  });

  document.getElementById("score").innerText = `✅ सही उत्तर: ${correct} ❌ गलत उत्तर: ${wrong} / कुल प्रश्न: ${total}`;
}

function restartQuiz() {
  document.getElementById("resultPage").classList.add("hidden");
  document.getElementById("welcomePage").classList.remove("hidden");
}
